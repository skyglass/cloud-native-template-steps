---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImageUpdateAutomation
metadata:
  name: default-update-automation
  # It only looks for updates in its namespace
  namespace: default
spec:
  interval: 15s
  sourceRef:
    kind: GitRepository
    name: flux-system
    namespace: flux-system
  git:
    # specifying checkout/commit branches here prevents testing on a test-branch
    commit:
      author:
        email: skyglass+fluxcdbot@skycomposer.net
        name: fluxcdbot
      messageTemplate: |
        Update Helm chart versions via Flux

        {{- range $path, $changes := .Changed }}
        {{- range $obj, $list := $changes }}
        {{- range $list }}
        - {{ $path }}: {{ .Old }} â†’ {{ .New }} ({{ .Policy }})
        {{- end }}
        {{- end }}
        {{- end }}
  update:
    path: ./flux/apps
    strategy: Setters